#!/bin/bash

# Script to investigate Pantheon's GCP integration
# Run this to understand your Pantheon build environment

echo "=== Pantheon GCP Investigation ==="
echo ""
echo "This script helps determine how to access Pantheon build data."
echo ""

# Step 1: Check if you have GCP credentials
echo "Step 1: GCP Authentication"
echo "=========================="
if command -v gcloud &> /dev/null; then
    echo "✅ gcloud CLI is installed"

    echo ""
    echo "Current GCP account:"
    gcloud auth list --filter=status:ACTIVE --format="value(account)"

    echo ""
    echo "Current GCP project:"
    gcloud config get-value project
else
    echo "❌ gcloud CLI not installed"
    echo "   Install: https://cloud.google.com/sdk/docs/install"
fi

echo ""
echo ""
echo "Step 2: Check Pantheon Configuration"
echo "====================================="
echo "Please manually check the following:"
echo ""
echo "1. Log into Pantheon Dashboard"
echo "2. Go to your benchmark site settings"
echo "3. Look for:"
echo "   - GCP project integration settings"
echo "   - Build configuration options"
echo "   - Environment variables"
echo "   - Any Cloud Build or GCP references"
echo ""

echo ""
echo "Step 3: Trigger a Test Build"
echo "============================"
echo "Trigger a build on Pantheon and check the build logs for:"
echo ""
echo "  - GCP Project ID (format: project-name-12345)"
echo "  - Build ID (format: uuid or similar)"
echo "  - Any Cloud Build URLs or references"
echo ""
echo "Build logs might show lines like:"
echo "  'Starting build in project: YOUR-PROJECT-ID'"
echo "  'Build ID: abc-123-def'"
echo ""

echo ""
echo "Step 4: Determine Your Approach"
echo "================================"
echo ""
echo "Based on what you find, choose one:"
echo ""
echo "Option A: Direct Cloud Build API Access"
echo "  ✓ You found a GCP project ID in build logs"
echo "  ✓ You have/can get service account access to that project"
echo "  → Use Cloud Build API polling (best for accurate metrics)"
echo ""
echo "Option B: Build Process Injection"
echo "  ✓ You can customize cloudbuild.yaml or build hooks"
echo "  ✓ Build can make HTTP calls during execution"
echo "  → Add reporting step to build process"
echo ""
echo "Option C: External Monitoring"
echo "  ✓ Pantheon site has a public URL"
echo "  → Poll the site URL to detect when new deployment is live"
echo "  → Less accurate, but works without GCP access"
echo ""
echo "Option D: Pantheon API (if available)"
echo "  ✓ Pantheon has an API endpoint for build status"
echo "  → Contact Pantheon support to ask about API options"
echo ""

echo ""
echo "Step 5: Report Back"
echo "==================="
echo "After investigation, you should know:"
echo ""
echo "[ ] What GCP project ID Pantheon uses for builds (if any)"
echo "[ ] Whether you can access Cloud Build API"
echo "[ ] Whether you can customize the build process"
echo "[ ] What build metadata is available in logs"
echo ""
echo "This will determine the best implementation approach."
echo ""
